<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Ergovia Prestige</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="/logo.png" type="image/png">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="/logo.png" alt="Ergovia" style="width:28px;height:auto;margin-right:4px;">
                <span>Ergovia</span>
            </div>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-item">
                    <i class="fas fa-th-large"></i>
                    <span>Dashboard</span>
                </a>
                <a href="settings.html" class="nav-item active">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Settings</span>
                </a>
                <a href="properties.html" class="nav-item">
                    <i class="fas fa-building"></i>
                    <span>Properties</span>
                </a>
            </div>
            <div class="nav-user">
                <button class="theme-toggle" id="themeToggle" title="Toggle dark mode">
                    <i class="fas fa-moon"></i>
                </button>
                <div class="notification-bell" id="notificationBell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationCount">0</span>
                </div>
                <div class="user-profile" id="userProfileBtn">
                    <i class="fas fa-user-circle"></i>
                    <span id="userName">Owner</span>
                    <i class="fas fa-chevron-down" style="font-size:11px;color:#a0aec0;"></i>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-dropdown-header">
                            <h4 id="dropdownUserName">Owner</h4>
                            <p id="dropdownUserEmail">owner@ergovia.com</p>
                        </div>
                        <a class="user-dropdown-item" href="settings.html"><i class="fas fa-cog"></i> Account Settings</a>
                        <div class="user-dropdown-divider"></div>
                        <button class="user-dropdown-item danger" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Log Out</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Notification Panel (Sidebar) -->
        <div class="notification-panel" id="notificationPanel">
            <div class="notification-header">
                <h3><i class="fas fa-bell"></i> Notifications</h3>
                <button class="btn-close" onclick="closeNotifications()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="notification-list" id="notificationList">
            </div>
        </div>

        <!-- n8n Connection Card -->
        <div class="n8n-card">
            <div id="n8nNotConnected">
                <div class="n8n-card-title">
                    <i class="fas fa-plug"></i>
                    <strong>Connect to n8n</strong>
                    <span class="n8n-badge-not-connected">Not Connected</span>
                </div>
                <p>Enter your n8n instance URL and API key to enable live workflow sync from this settings page.</p>
                <div class="n8n-input-grid">
                    <input type="url" id="n8nUrl" class="n8n-input" placeholder="http://116.203.115.12:5678">
                    <input type="password" id="n8nApiKey" class="n8n-input" placeholder="n8n API Key">
                </div>
                <button type="button" id="n8nConnectBtn" class="n8n-connect-btn" onclick="WorkflowSync.connectN8n()">
                    <i class="fas fa-plug"></i> Connect & Import Workflows
                </button>
            </div>
            <div id="n8nConnected" style="display:none;">
                <div class="n8n-connected-row">
                    <div class="n8n-connected-info">
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong id="n8nConnectedUrl">Connected to n8n</strong>
                            <div class="n8n-count" id="n8nConnectedCount">0 workflows linked</div>
                        </div>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <span style="color:var(--prestige-text-muted);font-size:12px;" id="syncLastStatus"></span>
                        <button type="button" class="n8n-disconnect-btn" onclick="WorkflowSync.disconnectN8n()" title="Disconnect">
                            <i class="fas fa-unlink"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Container -->
        <div class="form-container">
            <h1><i class="fas fa-cog"></i> Account Settings</h1>
            <p class="form-subtitle">Configure your AI assistant, workflows, and business preferences</p>

            <form id="fillupForm">

                <!-- ========================================== -->
                <!-- SECTION 1: Owner Information               -->
                <!-- ========================================== -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-user"></i> 1. Owner Information</h2>
                        <button type="button" class="btn-help" onclick="showHelp('owner')">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="ownerName">
                                <i class="fas fa-user"></i> Full Name
                                <span class="required">*</span>
                            </label>
                            <input type="text" id="ownerName" name="ownerName" required
                                   placeholder="John Smith">
                        </div>

                        <div class="form-group">
                            <label for="ownerEmail">
                                <i class="fas fa-envelope"></i> Email Address
                                <span class="required">*</span>
                            </label>
                            <input type="email" id="ownerEmail" name="ownerEmail" required
                                   placeholder="john@example.com">
                        </div>

                        <div class="form-group">
                            <label for="ownerPhone">
                                <i class="fas fa-phone"></i> Phone Number
                                <span class="required">*</span>
                            </label>
                            <input type="tel" id="ownerPhone" name="ownerPhone" required
                                   placeholder="+1234567890">
                        </div>

                        <div class="form-group">
                            <label for="preferredPlatform">
                                <i class="fas fa-comments"></i> Preferred Contact Platform
                                <span class="required">*</span>
                            </label>
                            <select id="preferredPlatform" name="preferredPlatform" required>
                                <option value="">Select platform...</option>
                                <option value="telegram">Telegram</option>
                                <option value="whatsapp">WhatsApp</option>
                                <option value="sms">SMS</option>
                            </select>
                        </div>

                        <div class="form-group" id="telegramChatIdGroup" style="display:none;">
                            <label for="telegramChatId">
                                <i class="fab fa-telegram"></i> Telegram Chat ID
                            </label>
                            <input type="text" id="telegramChatId" name="telegramChatId"
                                   placeholder="123456789">
                            <small class="help-text">
                                <a href="#" onclick="showTelegramHelp()">How to find my Chat ID?</a>
                            </small>
                        </div>

                        <div class="form-group" id="whatsappNumberGroup" style="display:none;">
                            <label for="whatsappNumber">
                                <i class="fab fa-whatsapp"></i> WhatsApp Number
                            </label>
                            <input type="tel" id="whatsappNumber" name="whatsappNumber"
                                   placeholder="+1234567890">
                        </div>
                    </div>

                    <button type="button" class="btn-save-section" id="saveBtn-owner" onclick="saveSection('owner')">
                        <i class="fas fa-save"></i> Save & Apply
                    </button>
                </div>

                <!-- ========================================== -->
                <!-- SECTION 2: API Credentials                 -->
                <!-- ========================================== -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-key"></i> 2. API Credentials</h2>
                        <button type="button" class="btn-help" onclick="showHelp('credentials')">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>

                    <div class="security-notice">
                        <i class="fas fa-shield-alt"></i>
                        <strong>Your credentials are secure:</strong> We never store your API keys in plain text.
                        They're encrypted and only used by your private AI assistant.
                    </div>

                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="telegramBotToken">
                                <i class="fab fa-telegram"></i> Telegram Bot Token
                                <span class="required">*</span>
                            </label>
                            <input type="password" id="telegramBotToken" name="telegramBotToken" required
                                   placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz">
                            <small class="help-text">
                                <a href="#" onclick="showCredentialHelp('telegram')">
                                    <i class="fas fa-question-circle"></i> How to get Telegram Bot Token?
                                </a>
                            </small>
                        </div>

                        <div class="form-group full-width">
                            <label for="whatsappApiKey">
                                <i class="fab fa-whatsapp"></i> WhatsApp Business API Key
                            </label>
                            <input type="password" id="whatsappApiKey" name="whatsappApiKey"
                                   placeholder="Your WhatsApp Business API key">
                            <small class="help-text">Required if using WhatsApp Business API directly (not through Twilio)</small>
                        </div>

                        <div class="form-group full-width" style="margin-bottom: 4px;">
                            <label>
                                <i class="fab fa-whatsapp"></i> Twilio Credentials
                                <small style="font-weight:normal; color: var(--prestige-text-muted);">(for WhatsApp &amp; SMS)</small>
                            </label>
                        </div>

                        <div class="form-group">
                            <label for="twilioAccountSid">Account SID</label>
                            <input type="password" id="twilioAccountSid" name="twilioAccountSid"
                                   placeholder="ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                        </div>

                        <div class="form-group">
                            <label for="twilioAuthToken">Auth Token</label>
                            <input type="password" id="twilioAuthToken" name="twilioAuthToken"
                                   placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                        </div>

                        <div class="form-group full-width">
                            <label for="twilioPhoneNumber">Twilio Phone Number</label>
                            <input type="tel" id="twilioPhoneNumber" name="twilioPhoneNumber"
                                   placeholder="+1234567890">
                            <small class="help-text">
                                <a href="#" onclick="showCredentialHelp('twilio')">
                                    <i class="fas fa-question-circle"></i> How to get Twilio credentials?
                                </a>
                            </small>
                        </div>
                    </div>

                    <button type="button" class="btn-save-section" id="saveBtn-credentials" onclick="saveSection('credentials')">
                        <i class="fas fa-save"></i> Save & Apply
                    </button>
                </div>

                <!-- ========================================== -->
                <!-- SECTION 3: AI Assistant (merged)           -->
                <!-- ========================================== -->
                <div class="form-section system-prompt-section" id="systemPromptSection">
                    <div class="section-header-form">
                        <h2><i class="fas fa-robot"></i> 3. AI Assistant</h2>
                        <span class="system-prompt-badge">Syncs to WF1</span>
                    </div>

                    <p class="section-description">
                        Control how your AI concierge behaves, what language it speaks, and its response style.
                        Changes sync directly to the live WF1 AI Gateway workflow.
                    </p>

                    <!-- Auto-Reply Toggle -->
                    <div class="setting-row">
                        <div class="setting-info">
                            <label><i class="fas fa-play-circle"></i> Auto-Reply Enabled</label>
                            <small>When OFF, the AI stops responding to guest messages (WF1 deactivated)</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="autoReplyEnabled" name="autoReplyEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="form-grid">
                        <!-- Language -->
                        <div class="form-group">
                            <label for="language">
                                <i class="fas fa-language"></i> Response Language
                            </label>
                            <select id="language" name="language">
                                <option value="en">English</option>
                                <option value="es">Spanish</option>
                                <option value="tl">Tagalog / Filipino</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="ja">Japanese</option>
                            </select>
                        </div>

                        <!-- AI Model -->
                        <div class="form-group">
                            <label for="aiModel">
                                <i class="fas fa-microchip"></i> AI Model
                            </label>
                            <select id="aiModel" name="aiModel">
                                <option value="gpt-4o-mini">GPT-4o Mini (fast, cheap)</option>
                                <option value="gpt-4o">GPT-4o (smart, pricier)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Temperature Slider -->
                    <div class="form-group full-width">
                        <label for="aiTemperature">
                            <i class="fas fa-thermometer-half"></i> AI Creativity (Temperature)
                            <span class="slider-value" id="aiTempValue">0.7</span>
                        </label>
                        <input type="range" id="aiTemperature" name="aiTemperature"
                               min="0" max="1" step="0.1" value="0.7"
                               class="range-slider"
                               oninput="document.getElementById('aiTempValue').textContent = this.value">
                        <div class="slider-labels">
                            <span>Precise (0.0)</span>
                            <span>Creative (1.0)</span>
                        </div>
                    </div>

                    <!-- AI Notes -->
                    <div class="form-group full-width">
                        <label for="aiNotes">
                            <i class="fas fa-comment-dots"></i> Special Instructions for AI
                        </label>
                        <textarea id="aiNotes" name="aiNotes" rows="5"
                                  placeholder="Example:
- Always offer early check-in if available
- We have a cat, so mention this to guests with allergies
- Cleaning crew arrives at 10 AM
- Never discount below $50/night"></textarea>
                    </div>

                    <!-- Pricing Rules -->
                    <div class="form-group full-width">
                        <label for="pricingRules">
                            <i class="fas fa-tags"></i> Pricing Rules
                        </label>
                        <textarea id="pricingRules" name="pricingRules" rows="3"
                                  placeholder="Example:
- Minimum price: $80/night
- Weekend pricing +30%
- Monthly stays -15%"></textarea>
                    </div>

                    <!-- System Prompt Editor (advanced) -->
                    <details class="advanced-section">
                        <summary><i class="fas fa-terminal"></i> Advanced: Edit System Prompt</summary>
                        <div class="form-group full-width" style="margin-top:12px;">
                            <label for="systemPromptEditor">
                                <i class="fas fa-brain"></i> System Prompt (raw)
                            </label>
                            <textarea id="systemPromptEditor" rows="10" style="font-family:monospace;font-size:13px;line-height:1.5;"
                                      placeholder="The AI concierge system prompt will appear here after connecting to n8n. You can edit it to change how your AI assistant behaves."></textarea>
                            <small class="help-text">This controls the personality, rules, and booking flow. Changes are appended as CLIENT CUSTOMIZATIONS.</small>
                        </div>

                        <div class="form-group full-width">
                            <label for="pricingRulesEditor">
                                <i class="fas fa-dollar-sign"></i> Custom Pricing Rules (appended to prompt)
                            </label>
                            <textarea id="pricingRulesEditor" rows="3" style="font-family:monospace;font-size:13px;"
                                      placeholder="These pricing rules are appended directly to the AI system prompt"></textarea>
                        </div>
                    </details>

                    <button type="button" class="btn-save-section" id="saveBtn-ai" onclick="saveSection('ai')" style="margin-top:16px;">
                        <i class="fas fa-save"></i> Save & Apply
                    </button>
                </div>

                <!-- ========================================== -->
                <!-- SECTION 4: Booking & Payment Defaults      -->
                <!-- ========================================== -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-calendar-check"></i> 4. Booking & Payment Defaults</h2>
                        <span class="system-prompt-badge">Syncs to WF2 + WF4</span>
                    </div>

                    <p class="section-description">
                        Global booking and payment settings. Per-property overrides can be set on the Properties page.
                    </p>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="defaultCurrency">
                                <i class="fas fa-dollar-sign"></i> Default Currency
                            </label>
                            <select id="defaultCurrency" name="defaultCurrency">
                                <option value="USD">USD ($)</option>
                                <option value="EUR">EUR</option>
                                <option value="PHP">PHP (&#8369;)</option>
                                <option value="GBP">GBP (&pound;)</option>
                                <option value="JPY">JPY (&yen;)</option>
                                <option value="AUD">AUD (A$)</option>
                                <option value="MXN">MXN</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="defaultPaymentMethod">
                                <i class="fas fa-credit-card"></i> Default Payment Method
                            </label>
                            <select id="defaultPaymentMethod" name="defaultPaymentMethod">
                                <option value="">Select...</option>
                                <option value="gcash">GCash</option>
                                <option value="paypal">PayPal</option>
                                <option value="stripe">Stripe</option>
                                <option value="bank_transfer">Bank Transfer</option>
                                <option value="cash">Cash</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="defaultCheckInTime">
                                <i class="fas fa-sign-in-alt"></i> Default Check-in Time
                            </label>
                            <input type="time" id="defaultCheckInTime" name="defaultCheckInTime" value="15:00">
                        </div>

                        <div class="form-group">
                            <label for="defaultCheckOutTime">
                                <i class="fas fa-sign-out-alt"></i> Default Check-out Time
                            </label>
                            <input type="time" id="defaultCheckOutTime" name="defaultCheckOutTime" value="11:00">
                        </div>

                        <div class="form-group">
                            <label for="globalTimezone">
                                <i class="fas fa-globe"></i> Timezone
                            </label>
                            <select id="globalTimezone" name="globalTimezone">
                                <option value="Asia/Manila">Philippines (UTC+8)</option>
                                <option value="Asia/Singapore">Singapore (UTC+8)</option>
                                <option value="Asia/Hong_Kong">Hong Kong (UTC+8)</option>
                                <option value="Asia/Tokyo">Japan (UTC+9)</option>
                                <option value="Asia/Seoul">South Korea (UTC+9)</option>
                                <option value="Asia/Bangkok">Thailand (UTC+7)</option>
                                <option value="Asia/Kolkata">India (UTC+5:30)</option>
                                <option value="Asia/Dubai">UAE (UTC+4)</option>
                                <option value="America/New_York">US Eastern (UTC-5)</option>
                                <option value="America/Chicago">US Central (UTC-6)</option>
                                <option value="America/Denver">US Mountain (UTC-7)</option>
                                <option value="America/Los_Angeles">US Pacific (UTC-8)</option>
                                <option value="Europe/London">UK (UTC+0)</option>
                                <option value="Europe/Paris">Europe Central (UTC+1)</option>
                                <option value="Australia/Sydney">Australia Eastern (UTC+11)</option>
                                <option value="UTC">UTC</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="minBookingLeadTime">
                                <i class="fas fa-hourglass-start"></i> Min Booking Lead Time (hours)
                            </label>
                            <input type="number" id="minBookingLeadTime" name="minBookingLeadTime"
                                   min="0" max="168" value="0" placeholder="0">
                            <small class="help-text">Reject bookings with less than X hours notice. 0 = allow same-day.</small>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="cancellationPolicy">
                            <i class="fas fa-file-contract"></i> Cancellation Policy
                        </label>
                        <textarea id="cancellationPolicy" name="cancellationPolicy" rows="3"
                                  placeholder="Example: Free cancellation up to 48 hours before check-in. After that, the first night is non-refundable."></textarea>
                        <small class="help-text">The AI will communicate this policy to guests asking about cancellations.</small>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="competingOfferTimeout">
                                <i class="fas fa-clock"></i> Competing Offer Timeout (hours)
                            </label>
                            <input type="number" id="competingOfferTimeout" name="competingOfferTimeout"
                                   min="1" max="48" value="2" placeholder="2">
                            <small class="help-text">Time you have to decide between overlapping offers.</small>
                        </div>

                        <div class="form-group">
                            <label for="offerHoldDuration">
                                <i class="fas fa-hand-paper"></i> Offer Hold Duration (hours)
                            </label>
                            <input type="number" id="offerHoldDuration" name="offerHoldDuration"
                                   min="1" max="72" value="24" placeholder="24">
                            <small class="help-text">How long to hold an offer before it expires.</small>
                        </div>
                    </div>

                    <!-- Payment Confirmation Toggle -->
                    <div class="setting-row">
                        <div class="setting-info">
                            <label><i class="fas fa-check-double"></i> Require Payment Confirmation</label>
                            <small>Owner must confirm payment before booking is finalized</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="requirePaymentConfirmation" name="requirePaymentConfirmation" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <h3 class="subsection-title"><i class="fas fa-percent"></i> Pricing & Discounts</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="serviceFeePercent">
                                <i class="fas fa-hand-holding-usd"></i> Service Fee (%)
                            </label>
                            <input type="number" id="serviceFeePercent" name="serviceFeePercent"
                                   min="0" max="50" step="0.5" value="12" placeholder="12">
                            <small class="help-text">Platform service fee added on top of the nightly rate.</small>
                        </div>

                        <div class="form-group">
                            <label for="weeklyDiscountPercent">
                                <i class="fas fa-tags"></i> Weekly Discount (%)
                            </label>
                            <input type="number" id="weeklyDiscountPercent" name="weeklyDiscountPercent"
                                   min="0" max="50" step="0.5" value="10" placeholder="10">
                            <small class="help-text">Discount applied for stays of 7+ nights.</small>
                        </div>
                    </div>

                    <button type="button" class="btn-save-section" id="saveBtn-booking" onclick="saveSection('booking')">
                        <i class="fas fa-save"></i> Save & Apply
                    </button>
                </div>

                <!-- ========================================== -->
                <!-- SECTION 5: Notifications & Safety          -->
                <!-- ========================================== -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-bell"></i> 5. Notifications & Safety</h2>
                        <span class="system-prompt-badge">Syncs to WF8 + SUB</span>
                    </div>

                    <p class="section-description">
                        Emergency contacts, notification preferences, and guest screening defaults.
                    </p>

                    <h3 class="subsection-title"><i class="fas fa-ambulance"></i> Emergency Contacts</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="emergencyContact1Name">
                                <i class="fas fa-user-shield"></i> Contact 1 - Name
                            </label>
                            <input type="text" id="emergencyContact1Name" name="emergencyContact1Name"
                                   placeholder="John Smith (Maintenance)">
                        </div>
                        <div class="form-group">
                            <label for="emergencyContact1Phone">
                                <i class="fas fa-phone-alt"></i> Contact 1 - Phone
                            </label>
                            <input type="tel" id="emergencyContact1Phone" name="emergencyContact1Phone"
                                   placeholder="+1234567890">
                        </div>
                        <div class="form-group">
                            <label for="emergencyContact2Name">
                                <i class="fas fa-user-shield"></i> Contact 2 - Name
                            </label>
                            <input type="text" id="emergencyContact2Name" name="emergencyContact2Name"
                                   placeholder="Jane Doe (Backup)">
                        </div>
                        <div class="form-group">
                            <label for="emergencyContact2Phone">
                                <i class="fas fa-phone-alt"></i> Contact 2 - Phone
                            </label>
                            <input type="tel" id="emergencyContact2Phone" name="emergencyContact2Phone"
                                   placeholder="+1234567890">
                        </div>
                    </div>

                    <h3 class="subsection-title"><i class="fas fa-envelope-open-text"></i> Notification Toggles</h3>
                    <div class="setting-row">
                        <div class="setting-info">
                            <label><i class="fas fa-calendar-plus"></i> New Booking</label>
                            <small>Notify when a new booking is created</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="notifyOnNewBooking" name="notifyOnNewBooking" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <label><i class="fas fa-door-open"></i> Check-In</label>
                            <small>Notify when a guest checks in</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="notifyOnCheckIn" name="notifyOnCheckIn" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <label><i class="fas fa-exchange-alt"></i> Competing Offer</label>
                            <small>Notify when dates overlap with another offer</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="notifyOnCompetingOffer" name="notifyOnCompetingOffer" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <label><i class="fas fa-chart-bar"></i> Daily Report</label>
                            <small>Receive a daily summary of activity</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="notifyDailyReport" name="notifyDailyReport" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <h3 class="subsection-title"><i class="fas fa-user-check"></i> Guest Screening</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="guestScreeningDefault">
                                <i class="fas fa-shield-alt"></i> Default Screening Mode
                            </label>
                            <select id="guestScreeningDefault" name="guestScreeningDefault">
                                <option value="auto_approve">Auto-Approve (trust all guests)</option>
                                <option value="flag_for_review" selected>Flag for Review (recommended)</option>
                                <option value="always_screen">Always Screen (strictest)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Watchdog Toggle -->
                    <div class="setting-row">
                        <div class="setting-info">
                            <label><i class="fas fa-eye"></i> Watchdog Monitoring (WF8)</label>
                            <small>15-minute safety checks for anomalies and emergencies</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="watchdogEnabled" name="watchdogEnabled" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <button type="button" class="btn-save-section" id="saveBtn-notifications" onclick="saveSection('notifications')">
                        <i class="fas fa-save"></i> Save & Apply
                    </button>
                </div>

                <!-- ========================================== -->
                <!-- SECTION 6: Budget & Usage                  -->
                <!-- ========================================== -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-wallet"></i> 6. Budget & Usage</h2>
                        <span class="system-prompt-badge">Syncs to WF1</span>
                    </div>

                    <p class="section-description">
                        Control AI spending limits. When the budget is exhausted, the AI sends the fallback message instead of using OpenAI.
                    </p>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="monthlyBudget">
                                <i class="fas fa-money-bill-wave"></i> Monthly Budget (USD)
                            </label>
                            <input type="number" id="monthlyBudget" name="monthlyBudget"
                                   min="5" max="1000" value="50" step="5" placeholder="50">
                        </div>
                    </div>

                    <h3 class="subsection-title"><i class="fas fa-exclamation-triangle"></i> Budget Alerts</h3>
                    <div class="setting-row">
                        <div class="setting-info">
                            <label><i class="fas fa-battery-half"></i> Alert at 50%</label>
                            <small>Notify when half the monthly budget is used</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="budgetAlert50" name="budgetAlert50" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <label><i class="fas fa-battery-quarter"></i> Alert at 80%</label>
                            <small>Notify when 80% of the monthly budget is used</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="budgetAlert80" name="budgetAlert80" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="setting-row">
                        <div class="setting-info">
                            <label><i class="fas fa-hand-paper"></i> Pause AI at 100%</label>
                            <small>Stop AI responses and send fallback message when budget is exhausted</small>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="budgetAlertLimit" name="budgetAlertLimit" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>

                    <div class="form-group full-width" style="margin-top:12px;">
                        <label for="fallbackMessage">
                            <i class="fas fa-comment-slash"></i> Fallback Message (when budget exhausted)
                        </label>
                        <textarea id="fallbackMessage" name="fallbackMessage" rows="3"
                                  placeholder="Thank you for your message! Our AI assistant is temporarily unavailable. Please contact us directly at [your phone/email] for immediate assistance."></textarea>
                    </div>

                    <button type="button" class="btn-save-section" id="saveBtn-budget" onclick="saveSection('budget')">
                        <i class="fas fa-save"></i> Save & Apply
                    </button>
                </div>

                <!-- ========================================== -->
                <!-- SECTION 7: Team & Contacts                 -->
                <!-- ========================================== -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-users"></i> 7. Team & Contacts</h2>
                        <button type="button" class="btn-help" onclick="showHelp('team')">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>

                    <p class="section-description">
                        Add people who help manage your properties. The AI will know who to contact for specific tasks
                        (cleaning, maintenance, key handoff, etc.).
                    </p>

                    <div id="teamMembersContainer">
                    </div>

                    <button type="button" class="btn-add" onclick="addTeamMember()">
                        <i class="fas fa-plus-circle"></i> Add Team Member
                    </button>

                    <button type="button" class="btn-save-section" id="saveBtn-team" onclick="saveSection('team')">
                        <i class="fas fa-save"></i> Save & Apply
                    </button>
                </div>

                <!-- ========================================== -->
                <!-- SECTION 8: Media & Documentation           -->
                <!-- ========================================== -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-image"></i> 8. Media & Documentation</h2>
                        <button type="button" class="btn-help" onclick="showHelp('media')">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>

                    <p class="section-description">
                        Provide Google Drive links to folders containing photos and videos
                        that the AI can send to guests when requested.
                    </p>

                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="propertyPhotosLink">
                                <i class="fab fa-google-drive"></i> Property Photos Folder
                            </label>
                            <input type="url" id="propertyPhotosLink" name="propertyPhotosLink"
                                   placeholder="https://drive.google.com/drive/folders/...">
                        </div>

                        <div class="form-group full-width">
                            <label for="propertyVideosLink">
                                <i class="fab fa-google-drive"></i> Property Videos Folder
                            </label>
                            <input type="url" id="propertyVideosLink" name="propertyVideosLink"
                                   placeholder="https://drive.google.com/drive/folders/...">
                        </div>

                        <div class="form-group full-width">
                            <label for="documentationLink">
                                <i class="fab fa-google-drive"></i> Guest Guides & Instructions
                            </label>
                            <input type="url" id="documentationLink" name="documentationLink"
                                   placeholder="https://drive.google.com/drive/folders/...">
                        </div>
                    </div>

                    <button type="button" class="btn-save-section" id="saveBtn-media" onclick="saveSection('media')">
                        <i class="fas fa-save"></i> Save & Apply
                    </button>
                </div>

            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/config.js"></script>
    <script src="assets/js/auth-guard.js"></script>
    <script src="assets/js/sync.js"></script>
    <script src="assets/js/notifications.js"></script>
    <script src="assets/js/fillup-form.js"></script>
    <script>
        // User dropdown toggle
        document.getElementById('userProfileBtn')?.addEventListener('click', function(e) {
            e.stopPropagation();
            document.getElementById('userDropdown')?.classList.toggle('active');
        });
        document.addEventListener('click', function() {
            document.getElementById('userDropdown')?.classList.remove('active');
        });
        // Logout handler
        document.getElementById('logoutBtn')?.addEventListener('click', function() {
            localStorage.removeItem('ergovia_token');
            localStorage.removeItem('ergovia_user');
            window.location.href = '/login.html';
        });
        // Theme toggle
        (function() {
            const saved = localStorage.getItem('ergovia_theme');
            if (saved === 'dark') document.documentElement.setAttribute('data-theme', 'dark');
            const btn = document.getElementById('themeToggle');
            if (!btn) return;
            function updateIcon() {
                const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                btn.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            }
            updateIcon();
            btn.addEventListener('click', function() {
                const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                if (isDark) {
                    document.documentElement.removeAttribute('data-theme');
                    localStorage.setItem('ergovia_theme', 'light');
                } else {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    localStorage.setItem('ergovia_theme', 'dark');
                }
                updateIcon();
            });
        })();
    </script>
</body>
</html>
