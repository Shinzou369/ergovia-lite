<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Ergovia Prestige</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== V4 PRESTIGE DESIGN OVERRIDES ===== */
        :root {
            --navy: #1a365d;
            --navy-light: #2a4a7f;
            --navy-dark: #132847;
            --navy-bg: #0f2440;
            --gold: #c9a962;
            --gold-light: #d4bb7e;
            --gold-dark: #b8943f;
            --gold-glow: rgba(201, 169, 98, 0.15);
            --gold-glow-strong: rgba(201, 169, 98, 0.3);
            --prestige-bg: #f7f5f0;
            --prestige-card: #ffffff;
            --prestige-border: #e8e2d6;
            --prestige-text: #1a1a2e;
            --prestige-text-muted: #6b7280;
            --prestige-section-bg: #faf8f4;
        }

        body {
            background-color: var(--prestige-bg);
            color: var(--prestige-text);
        }

        /* Navbar */
        .navbar {
            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-dark) 100%);
            border-bottom: 2px solid var(--gold);
            box-shadow: 0 2px 20px rgba(26, 54, 93, 0.3);
        }

        .nav-logo {
            color: var(--gold);
        }

        .nav-logo span {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
            letter-spacing: 0.5px;
        }

        .nav-item {
            color: rgba(255, 255, 255, 0.7);
            border-bottom: 3px solid transparent;
            border-radius: 0;
            padding: 16px 24px;
            transition: all 0.3s;
        }

        .nav-item:hover {
            color: #fff;
            background-color: rgba(255, 255, 255, 0.08);
        }

        .nav-item.active {
            color: var(--gold);
            border-bottom-color: var(--gold);
            background-color: rgba(201, 169, 98, 0.08);
        }

        .notification-bell {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .notification-bell:hover {
            background-color: rgba(201, 169, 98, 0.2);
        }

        .notification-bell i {
            color: rgba(255, 255, 255, 0.85);
        }

        .notification-badge {
            background-color: var(--gold);
            color: var(--navy-dark);
            font-weight: 800;
        }

        .user-profile {
            color: rgba(255, 255, 255, 0.85);
            position: relative;
        }

        .user-profile:hover {
            background-color: rgba(255, 255, 255, 0.08);
        }

        .user-profile i.fa-user-circle {
            color: var(--gold);
        }

        .user-profile #userName {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        /* User Dropdown */
        .user-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(26, 54, 93, 0.2), 0 0 0 1px var(--prestige-border);
            min-width: 240px;
            z-index: 3000;
            overflow: hidden;
        }

        .user-dropdown.active {
            display: block;
        }

        .user-dropdown-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--prestige-border);
            background: var(--prestige-section-bg);
        }

        .user-dropdown-header h4 {
            font-size: 15px;
            color: var(--navy);
            font-weight: 700;
        }

        .user-dropdown-header p {
            font-size: 13px;
            color: var(--prestige-text-muted);
            margin-top: 2px;
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            font-size: 14px;
            color: var(--prestige-text);
            text-decoration: none;
            border: none;
            background: none;
            width: 100%;
            cursor: pointer;
            transition: background 0.15s;
        }

        .user-dropdown-item:hover {
            background-color: var(--gold-glow);
        }

        .user-dropdown-item i {
            width: 18px;
            text-align: center;
            color: var(--prestige-text-muted);
        }

        .user-dropdown-item.danger {
            color: #dc3545;
        }

        .user-dropdown-item.danger i {
            color: #dc3545;
        }

        .user-dropdown-divider {
            height: 1px;
            background: var(--prestige-border);
            margin: 4px 0;
        }

        /* Sync Banner */
        #syncBanner {
            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%) !important;
            border: 1px solid rgba(201, 169, 98, 0.3);
            box-shadow: 0 2px 12px rgba(26, 54, 93, 0.2) !important;
        }

        /* Form Container */
        .form-container {
            border: 1px solid var(--prestige-border);
            box-shadow: 0 4px 20px rgba(26, 54, 93, 0.06);
        }

        .form-container h1 {
            color: var(--navy);
        }

        .form-container h1 i {
            color: var(--gold);
        }

        .form-subtitle {
            color: var(--prestige-text-muted);
        }

        /* Progress Bar */
        .progress-fill {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
        }

        .progress-bar {
            background-color: var(--prestige-border);
        }

        .progress-text {
            color: var(--prestige-text-muted);
        }

        /* n8n Connection Card */
        .n8n-card {
            background: var(--prestige-card);
            border: 1px solid var(--prestige-border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .n8n-card-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .n8n-card-title i {
            color: var(--gold);
            font-size: 18px;
        }

        .n8n-card-title strong {
            color: var(--navy);
            font-size: 16px;
        }

        .n8n-badge-not-connected {
            background: #e74c3c;
            color: #fff;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            margin-left: auto;
        }

        .n8n-badge-connected {
            background: #42b72a;
            color: #fff;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            margin-left: auto;
        }

        .n8n-card p {
            color: var(--prestige-text-muted);
            font-size: 13px;
            margin-bottom: 12px;
        }

        .n8n-input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .n8n-input {
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid var(--prestige-border);
            background: var(--prestige-section-bg);
            color: var(--prestige-text);
            font-size: 13px;
            transition: border-color 0.2s;
        }

        .n8n-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px var(--gold-glow);
        }

        .n8n-connect-btn {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: var(--navy-dark);
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .n8n-connect-btn:hover {
            background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 100%);
            box-shadow: 0 4px 12px rgba(201, 169, 98, 0.3);
        }

        .n8n-connected-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .n8n-connected-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .n8n-connected-info i {
            color: #42b72a;
            font-size: 20px;
        }

        .n8n-connected-info strong {
            color: var(--navy);
        }

        .n8n-connected-info .n8n-count {
            color: #42b72a;
            font-size: 12px;
        }

        .n8n-disconnect-btn {
            padding: 4px 12px;
            border-radius: 6px;
            border: 1px solid var(--prestige-border);
            background: transparent;
            color: var(--prestige-text-muted);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .n8n-disconnect-btn:hover {
            border-color: #e74c3c;
            color: #e74c3c;
        }

        /* Form Sections */
        .form-section {
            background-color: var(--prestige-section-bg);
            border: 1px solid var(--prestige-border);
        }

        .section-header-form {
            border-bottom-color: var(--prestige-border);
        }

        .section-header-form h2 {
            color: var(--navy);
        }

        .section-header-form h2 i {
            color: var(--gold);
        }

        .section-description {
            color: var(--prestige-text-muted);
        }

        .form-group label {
            color: var(--prestige-text);
        }

        .form-group label i {
            color: var(--gold-dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            border-color: var(--prestige-border);
            background: #fff;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--gold);
            box-shadow: 0 0 0 3px var(--gold-glow);
        }

        .help-text {
            color: var(--prestige-text-muted);
        }

        .help-text a {
            color: var(--navy-light);
        }

        .btn-save-section {
            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
            color: #fff;
            border: none;
            box-shadow: 0 2px 8px rgba(26, 54, 93, 0.15);
            transition: all 0.3s;
        }

        .btn-save-section:hover {
            background: linear-gradient(135deg, var(--navy-light) 0%, var(--navy) 100%);
            box-shadow: 0 4px 16px rgba(26, 54, 93, 0.25);
            transform: translateY(-1px);
        }

        .btn-add {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: var(--navy-dark);
            font-weight: 700;
            border: none;
            box-shadow: 0 2px 8px rgba(201, 169, 98, 0.3);
        }

        .btn-add:hover {
            background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 100%);
            box-shadow: 0 4px 16px rgba(201, 169, 98, 0.4);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
            color: #fff;
            border: none;
            box-shadow: 0 2px 8px rgba(26, 54, 93, 0.2);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--navy-light) 0%, var(--navy) 100%);
            box-shadow: 0 4px 16px rgba(26, 54, 93, 0.3);
        }

        .btn-help {
            color: var(--gold);
        }

        .btn-help:hover {
            background-color: var(--gold-glow);
        }

        .security-notice {
            background-color: var(--gold-glow);
            border-left-color: var(--gold);
        }

        .security-notice i {
            color: var(--gold-dark);
        }

        /* System Prompt Section */
        .form-section.system-prompt-section {
            border-left: 3px solid var(--gold);
        }

        .system-prompt-badge {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: var(--navy-dark);
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
        }

        .btn-sync-prompt {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: var(--navy-dark);
            font-weight: 700;
            margin-top: 16px;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(201, 169, 98, 0.3);
            transition: all 0.3s;
        }

        .btn-sync-prompt:hover {
            background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 100%);
            box-shadow: 0 4px 16px rgba(201, 169, 98, 0.4);
            transform: translateY(-1px);
        }

        /* Activation Section */
        .activation-section {
            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 50%, var(--navy-dark) 100%);
            border: 2px solid var(--gold);
            position: relative;
            overflow: hidden;
        }

        .activation-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(201, 169, 98, 0.05) 50%, transparent 100%);
            pointer-events: none;
        }

        .activation-notice i {
            color: var(--gold);
        }

        .btn-activate {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: var(--navy-dark);
            font-weight: 800;
            letter-spacing: 0.5px;
            border: none;
            box-shadow: 0 4px 20px rgba(201, 169, 98, 0.4);
            transition: all 0.3s;
        }

        .btn-activate:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(201, 169, 98, 0.5);
        }

        .btn-activate:disabled {
            background: rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.4);
            box-shadow: none;
            cursor: not-allowed;
            opacity: 1;
        }

        .completion-requirement {
            color: rgba(255, 255, 255, 0.7);
        }

        /* Activation Modal */
        .activation-modal-content {
            text-align: center;
            border: 1px solid var(--prestige-border);
        }

        .activation-modal-content h2 {
            color: var(--navy);
        }

        .activation-modal-content p {
            color: var(--prestige-text-muted);
        }

        .spinner {
            border-top-color: var(--gold);
        }

        .progress-fill-loading {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
        }

        /* Team Member Cards */
        .team-member-card {
            background: #fff;
            border: 1px solid var(--prestige-border);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            transition: border-color 0.2s;
        }

        .team-member-card:hover {
            border-color: var(--gold);
        }

        /* Notification Panel */
        .notification-panel {
            border-left: 2px solid var(--gold);
        }

        .notification-header {
            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
            color: #fff;
            border-bottom: 2px solid var(--gold);
        }

        .notification-header h3 {
            color: #fff;
        }

        .notification-header .btn-close {
            color: rgba(255, 255, 255, 0.7);
        }

        .notification-item.unread {
            background-color: var(--gold-glow);
            border-left-color: var(--gold);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--prestige-border);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gold);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .n8n-input-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="/logo.png" alt="Ergovia" style="width:28px;height:auto;margin-right:4px;">
                <span>Ergovia</span>
            </div>
            <div class="nav-menu">
                <a href="dashboard.html" class="nav-item">
                    <i class="fas fa-th-large"></i>
                    <span>Dashboard</span>
                </a>
                <a href="settings.html" class="nav-item active">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Settings</span>
                </a>
                <a href="properties.html" class="nav-item">
                    <i class="fas fa-building"></i>
                    <span>Properties</span>
                </a>
            </div>
            <div class="nav-user">
                <div class="notification-bell" id="notificationBell">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationCount">0</span>
                </div>
                <div class="user-profile" id="userProfileBtn">
                    <i class="fas fa-user-circle"></i>
                    <span id="userName">Owner</span>
                    <i class="fas fa-chevron-down" style="font-size:11px;color:#a0aec0;"></i>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-dropdown-header">
                            <h4 id="dropdownUserName">Owner</h4>
                            <p id="dropdownUserEmail">owner@ergovia.com</p>
                        </div>
                        <a class="user-dropdown-item" href="settings.html"><i class="fas fa-cog"></i> Account Settings</a>
                        <div class="user-dropdown-divider"></div>
                        <button class="user-dropdown-item danger" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Log Out</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Notification Panel (Sidebar) -->
        <div class="notification-panel" id="notificationPanel">
            <div class="notification-header">
                <h3><i class="fas fa-bell"></i> Notifications</h3>
                <button class="btn-close" onclick="closeNotifications()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="notification-list" id="notificationList">
                <!-- Notifications will be loaded here -->
            </div>
        </div>

        <!-- Sync Banner -->
        <div id="syncBanner" style="display:none;align-items:center;gap:12px;padding:14px 20px;margin-bottom:16px;background:linear-gradient(135deg,#1a365d,#2a4a7f);color:#fff;border-radius:10px;font-size:14px;box-shadow:0 2px 8px rgba(26,54,93,0.3);">
        </div>

        <!-- Progress Indicator -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">0% Complete</p>
        </div>

        <!-- n8n Connection Card -->
        <div class="n8n-card">
            <!-- Not connected state -->
            <div id="n8nNotConnected">
                <div class="n8n-card-title">
                    <i class="fas fa-plug"></i>
                    <strong>Connect to n8n</strong>
                    <span class="n8n-badge-not-connected">Not Connected</span>
                </div>
                <p>Enter your n8n instance URL and API key to enable live workflow sync from this settings page.</p>
                <div class="n8n-input-grid">
                    <input type="url" id="n8nUrl" class="n8n-input" placeholder="http://116.203.115.12:5678">
                    <input type="password" id="n8nApiKey" class="n8n-input" placeholder="n8n API Key">
                </div>
                <button type="button" id="n8nConnectBtn" class="n8n-connect-btn" onclick="WorkflowSync.connectN8n()">
                    <i class="fas fa-plug"></i> Connect & Import Workflows
                </button>
            </div>

            <!-- Connected state (hidden initially) -->
            <div id="n8nConnected" style="display:none;">
                <div class="n8n-connected-row">
                    <div class="n8n-connected-info">
                        <i class="fas fa-check-circle"></i>
                        <div>
                            <strong id="n8nConnectedUrl">Connected to n8n</strong>
                            <div class="n8n-count" id="n8nConnectedCount">0 workflows linked</div>
                        </div>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <span style="color:var(--prestige-text-muted);font-size:12px;" id="syncLastStatus"></span>
                        <button type="button" class="n8n-disconnect-btn" onclick="WorkflowSync.disconnectN8n()" title="Disconnect">
                            <i class="fas fa-unlink"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Container -->
        <div class="form-container">
            <h1><i class="fas fa-cog"></i> Account Settings</h1>
            <p class="form-subtitle">Configure your AI assistant and manage your account</p>

            <form id="fillupForm" onsubmit="return handleFormSubmit(event)">

                <!-- SECTION 1: Owner Information -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-user"></i> 1. Owner Information</h2>
                        <button type="button" class="btn-help" onclick="showHelp('owner')">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="ownerName">
                                <i class="fas fa-user"></i> Full Name
                                <span class="required">*</span>
                            </label>
                            <input type="text" id="ownerName" name="ownerName" required
                                   placeholder="John Smith">
                        </div>

                        <div class="form-group">
                            <label for="ownerEmail">
                                <i class="fas fa-envelope"></i> Email Address
                                <span class="required">*</span>
                            </label>
                            <input type="email" id="ownerEmail" name="ownerEmail" required
                                   placeholder="john@example.com">
                        </div>

                        <div class="form-group">
                            <label for="ownerPhone">
                                <i class="fas fa-phone"></i> Phone Number
                                <span class="required">*</span>
                            </label>
                            <input type="tel" id="ownerPhone" name="ownerPhone" required
                                   placeholder="+1234567890">
                        </div>

                        <div class="form-group">
                            <label for="preferredPlatform">
                                <i class="fas fa-comments"></i> Preferred Contact Platform
                                <span class="required">*</span>
                            </label>
                            <select id="preferredPlatform" name="preferredPlatform" required>
                                <option value="">Select platform...</option>
                                <option value="telegram">Telegram</option>
                                <option value="whatsapp">WhatsApp</option>
                                <option value="sms">SMS</option>
                            </select>
                        </div>

                        <div class="form-group" id="telegramChatIdGroup" style="display:none;">
                            <label for="telegramChatId">
                                <i class="fab fa-telegram"></i> Telegram Chat ID
                            </label>
                            <input type="text" id="telegramChatId" name="telegramChatId"
                                   placeholder="123456789">
                            <small class="help-text">
                                <a href="#" onclick="showTelegramHelp()">How to find my Chat ID?</a>
                            </small>
                        </div>

                        <div class="form-group" id="whatsappNumberGroup" style="display:none;">
                            <label for="whatsappNumber">
                                <i class="fab fa-whatsapp"></i> WhatsApp Number
                            </label>
                            <input type="tel" id="whatsappNumber" name="whatsappNumber"
                                   placeholder="+1234567890">
                        </div>
                    </div>

                    <button type="button" class="btn-save-section" onclick="saveSection('owner')">
                        <i class="fas fa-save"></i> Save Section
                    </button>
                </div>

                <!-- SECTION 2: API Credentials -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-key"></i> 2. API Credentials</h2>
                        <button type="button" class="btn-help" onclick="showHelp('credentials')">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>

                    <div class="security-notice">
                        <i class="fas fa-shield-alt"></i>
                        <strong>Your credentials are secure:</strong> We never store your API keys in plain text.
                        They're encrypted and only used by your private AI assistant.
                    </div>

                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="telegramBotToken">
                                <i class="fab fa-telegram"></i> Telegram Bot Token
                                <span class="required">*</span>
                            </label>
                            <input type="password" id="telegramBotToken" name="telegramBotToken" required
                                   placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz">
                            <small class="help-text">
                                <a href="#" onclick="showCredentialHelp('telegram')">
                                    <i class="fas fa-question-circle"></i> How to get Telegram Bot Token?
                                </a>
                            </small>
                        </div>

                        <div class="form-group full-width">
                            <label for="whatsappApiKey">
                                <i class="fab fa-whatsapp"></i> WhatsApp Business API Key
                            </label>
                            <input type="password" id="whatsappApiKey" name="whatsappApiKey"
                                   placeholder="Your WhatsApp Business API key">
                            <small class="help-text">Required if using WhatsApp Business API directly (not through Twilio)</small>
                        </div>

                        <div class="form-group full-width" style="margin-bottom: 4px;">
                            <label>
                                <i class="fab fa-whatsapp"></i> Twilio Credentials
                                <small style="font-weight:normal; color: var(--prestige-text-muted);">(for WhatsApp &amp; SMS)</small>
                            </label>
                        </div>

                        <div class="form-group">
                            <label for="twilioAccountSid">Account SID</label>
                            <input type="password" id="twilioAccountSid" name="twilioAccountSid"
                                   placeholder="ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                        </div>

                        <div class="form-group">
                            <label for="twilioAuthToken">Auth Token</label>
                            <input type="password" id="twilioAuthToken" name="twilioAuthToken"
                                   placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                        </div>

                        <div class="form-group full-width">
                            <label for="twilioPhoneNumber">Twilio Phone Number</label>
                            <input type="tel" id="twilioPhoneNumber" name="twilioPhoneNumber"
                                   placeholder="+1234567890">
                            <small class="help-text">
                                <a href="#" onclick="showCredentialHelp('twilio')">
                                    <i class="fas fa-question-circle"></i> How to get Twilio credentials?
                                </a>
                            </small>
                        </div>
                    </div>

                    <button type="button" class="btn-save-section" onclick="saveSection('credentials')">
                        <i class="fas fa-save"></i> Save Section
                    </button>
                </div>

                <!-- SECTION 3: Team & Contacts -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-users"></i> 3. Team & Contacts</h2>
                        <button type="button" class="btn-help" onclick="showHelp('team')">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>

                    <p class="section-description">
                        Add people who help manage your properties. The AI will know who to contact for specific tasks.
                    </p>

                    <div id="teamMembersContainer">
                        <!-- Team members will be added here dynamically -->
                    </div>

                    <button type="button" class="btn-add" onclick="addTeamMember()">
                        <i class="fas fa-plus-circle"></i> Add Team Member
                    </button>

                    <button type="button" class="btn-save-section" onclick="saveSection('team')">
                        <i class="fas fa-save"></i> Save Section
                    </button>
                </div>

                <!-- SECTION 4: AI Assistant Notes -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-robot"></i> 4. AI Assistant Notes</h2>
                        <button type="button" class="btn-help" onclick="showHelp('ai')">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>

                    <p class="section-description">
                        Tell your AI assistant anything important it should know about your business,
                        preferences, or special situations.
                    </p>

                    <div class="form-group full-width">
                        <label for="aiNotes">
                            <i class="fas fa-comment-dots"></i> Special Instructions for AI
                        </label>
                        <textarea id="aiNotes" name="aiNotes" rows="6"
                                  placeholder="Example:
- Always offer early check-in if available
- We have a cat, so mention this to guests with allergies
- Cleaning crew arrives at 10 AM
- Never discount below $50/night
- Emergency maintenance contact: John 555-1234"></textarea>
                    </div>

                    <div class="form-group full-width">
                        <label for="pricingRules">
                            <i class="fas fa-dollar-sign"></i> Pricing Rules
                        </label>
                        <textarea id="pricingRules" name="pricingRules" rows="4"
                                  placeholder="Example:
- Minimum price: $80/night
- Never go below 20% discount
- Weekend pricing +30%
- Monthly stays -15%"></textarea>
                    </div>

                    <button type="button" class="btn-save-section" onclick="saveSection('ai')">
                        <i class="fas fa-save"></i> Save Section
                    </button>
                </div>

                <!-- SECTION 5: AI System Prompt (Live) -->
                <div class="form-section system-prompt-section" id="systemPromptSection">
                    <div class="section-header-form">
                        <h2><i class="fas fa-brain"></i> 5. AI System Prompt (Live)</h2>
                        <span class="system-prompt-badge">Syncs to n8n</span>
                    </div>

                    <p class="section-description">
                        This is the core instruction set for your AI concierge. Changes here are pushed
                        directly to the live WF1 AI Gateway workflow. Edit how your AI behaves, responds,
                        and handles the booking flow.
                    </p>

                    <div class="form-group full-width">
                        <label for="systemPromptEditor">
                            <i class="fas fa-terminal"></i> System Prompt
                        </label>
                        <textarea id="systemPromptEditor" rows="12" style="font-family:monospace;font-size:13px;line-height:1.5;"
                                  placeholder="The AI concierge system prompt will appear here after first deployment. You can edit it to change how your AI assistant behaves."></textarea>
                        <small class="help-text">This controls the personality, rules, and booking flow of your AI assistant.</small>
                    </div>

                    <div class="form-group full-width">
                        <label for="pricingRulesEditor">
                            <i class="fas fa-tags"></i> Custom Pricing Rules (appended to prompt)
                        </label>
                        <textarea id="pricingRulesEditor" rows="4" style="font-family:monospace;font-size:13px;"
                                  placeholder="Example:
- Last-minute bookings (within 48h) get 10% discount
- Stays over 7 nights get 15% off
- Holiday weekends are non-negotiable pricing"></textarea>
                    </div>

                    <button type="button" id="saveSystemPromptBtn" class="btn-sync-prompt">
                        <i class="fas fa-cloud-upload-alt"></i> Save & Sync to AI
                    </button>
                </div>

                <!-- SECTION 6: Photos & Videos -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-image"></i> 6. Photos & Videos</h2>
                        <button type="button" class="btn-help" onclick="showHelp('media')">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>

                    <p class="section-description">
                        Provide Google Drive links to folders containing photos and videos
                        that the AI can send to guests when requested.
                    </p>

                    <div class="form-grid">
                        <div class="form-group full-width">
                            <label for="propertyPhotosLink">
                                <i class="fab fa-google-drive"></i> Property Photos Folder
                            </label>
                            <input type="url" id="propertyPhotosLink" name="propertyPhotosLink"
                                   placeholder="https://drive.google.com/drive/folders/...">
                        </div>

                        <div class="form-group full-width">
                            <label for="propertyVideosLink">
                                <i class="fab fa-google-drive"></i> Property Videos Folder
                            </label>
                            <input type="url" id="propertyVideosLink" name="propertyVideosLink"
                                   placeholder="https://drive.google.com/drive/folders/...">
                        </div>

                        <div class="form-group full-width">
                            <label for="documentationLink">
                                <i class="fab fa-google-drive"></i> Guest Guides & Instructions
                            </label>
                            <input type="url" id="documentationLink" name="documentationLink"
                                   placeholder="https://drive.google.com/drive/folders/...">
                        </div>
                    </div>

                    <button type="button" class="btn-save-section" onclick="saveSection('media')">
                        <i class="fas fa-save"></i> Save Section
                    </button>
                </div>

                <!-- SECTION 7: Preferences -->
                <div class="form-section">
                    <div class="section-header-form">
                        <h2><i class="fas fa-sliders-h"></i> 7. Preferences</h2>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="language">
                                <i class="fas fa-language"></i> Language
                            </label>
                            <select id="language" name="language">
                                <option value="en">English</option>
                                <option value="es">Spanish</option>
                                <option value="tl">Tagalog</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="ja">Japanese</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="globalTimezone">
                                <i class="fas fa-globe"></i> Timezone
                            </label>
                            <select id="globalTimezone" name="globalTimezone">
                                <option value="Asia/Manila">Philippines (UTC+8)</option>
                                <option value="Asia/Singapore">Singapore (UTC+8)</option>
                                <option value="Asia/Hong_Kong">Hong Kong (UTC+8)</option>
                                <option value="Asia/Tokyo">Japan (UTC+9)</option>
                                <option value="Asia/Seoul">South Korea (UTC+9)</option>
                                <option value="Asia/Bangkok">Thailand (UTC+7)</option>
                                <option value="Asia/Kolkata">India (UTC+5:30)</option>
                                <option value="Asia/Dubai">UAE (UTC+4)</option>
                                <option value="America/New_York">US Eastern (UTC-5)</option>
                                <option value="America/Chicago">US Central (UTC-6)</option>
                                <option value="America/Denver">US Mountain (UTC-7)</option>
                                <option value="America/Los_Angeles">US Pacific (UTC-8)</option>
                                <option value="Europe/London">UK (UTC+0)</option>
                                <option value="Europe/Paris">Europe Central (UTC+1)</option>
                                <option value="Australia/Sydney">Australia Eastern (UTC+11)</option>
                                <option value="UTC">UTC</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="currency">
                                <i class="fas fa-dollar-sign"></i> Currency
                            </label>
                            <select id="currency" name="currency">
                                <option value="USD">USD ($)</option>
                                <option value="EUR">EUR</option>
                                <option value="PHP">PHP</option>
                                <option value="GBP">GBP</option>
                                <option value="JPY">JPY</option>
                                <option value="AUD">AUD (A$)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="paymentMethod">
                                <i class="fas fa-credit-card"></i> Preferred Payment
                            </label>
                            <select id="paymentMethod" name="paymentMethod">
                                <option value="">Select...</option>
                                <option value="gcash">GCash</option>
                                <option value="paypal">PayPal</option>
                                <option value="stripe">Stripe</option>
                                <option value="bank_transfer">Bank Transfer</option>
                                <option value="cash">Cash</option>
                            </select>
                        </div>
                    </div>

                    <button type="button" class="btn-save-section" onclick="saveSection('preferences')">
                        <i class="fas fa-save"></i> Save Section
                    </button>
                </div>

                <!-- Activation Section -->
                <div class="activation-section">
                    <div class="activation-notice">
                        <i class="fas fa-rocket"></i>
                        <h3>Ready to Activate?</h3>
                        <p>Once you click "Activate AI Assistant", your workflows will be configured and deployed.
                           This may take 2-3 minutes.</p>
                    </div>

                    <button type="submit" class="btn-activate" id="activateBtn" disabled>
                        <i class="fas fa-power-off"></i> Activate AI Assistant
                    </button>

                    <p class="completion-requirement" id="completionRequirement">
                        <i class="fas fa-exclamation-triangle"></i>
                        Please complete all required sections before activating
                    </p>
                </div>
            </form>
        </div>
    </div>

    <!-- Activation Loading Modal -->
    <div class="modal" id="loadingModal" style="display:none;">
        <div class="modal-content loading-modal activation-modal-content">
            <div class="spinner"></div>
            <h2>Activating Your AI Assistant</h2>
            <p id="activationStatus">Configuring workflows...</p>
            <div class="progress-bar-loading">
                <div class="progress-fill-loading" id="activationProgress"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/config.js"></script>
    <script src="assets/js/auth-guard.js"></script>
    <script src="assets/js/sync.js"></script>
    <script src="assets/js/notifications.js"></script>
    <script src="assets/js/fillup-form.js"></script>
    <script>
        // User dropdown toggle
        document.getElementById('userProfileBtn')?.addEventListener('click', function(e) {
            e.stopPropagation();
            document.getElementById('userDropdown')?.classList.toggle('active');
        });
        document.addEventListener('click', function() {
            document.getElementById('userDropdown')?.classList.remove('active');
        });
        // Logout handler
        document.getElementById('logoutBtn')?.addEventListener('click', function() {
            localStorage.removeItem('ergovia_token');
            localStorage.removeItem('ergovia_user');
            window.location.href = '/login.html';
        });
    </script>
</body>
</html>
